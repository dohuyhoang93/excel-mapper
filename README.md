# Excel Data Mapper

A powerful application to map and transfer data between Excel files while preserving formatting and styles.

---

## ‚ú® Key Features

- **Flexible Column Mapping**: Automatically suggests and allows manual mapping between source and destination columns.
- **Preserve Formatting**: Fully maintains the format, style, color, and borders of the destination Excel file.
- **Merged Cell Handling**: Intelligently supports reading from and writing to merged cells.
- **Data Sorting**: Allows sorting data by a specified column before the transfer.
- **Save/Load Configuration**: Saves mapping configurations to a JSON file for reuse.
- **User-Friendly Interface**: Uses ttkbootstrap with switchable light/dark themes.
- **Comprehensive Error Handling**: Provides clear error messages and automatic backups for the destination file.
- **Robust Validation**: Checks mapping validity (e.g., avoids duplicate destination columns) before execution.

### New Features & Improvements
- **Advanced File Handle Management**: Integrated mechanism to automatically detect and notify if an Excel file is locked by another program (e.g., Microsoft Excel), prompting the user to close it to prevent errors.
- **Automatic Memory Release**: Proactively releases resources after each file read/write operation to increase stability and reduce the risk of the application hanging.
- **Improved Header Reading Logic**: Ensures complex, multi-row headers are read correctly and nameless columns are discarded.
- **Improved Data Writing Logic**: Fixed a bug that could overwrite the destination file's header when it contained vertically merged cells.

## üèóÔ∏è Project Structure (Actual)

The project structure has been streamlined, with most of the logic consolidated into `app.py` to create a self-contained, easily packageable application.

```
excel_mapper/
‚îú‚îÄ‚îÄ app.py                   # Main file containing the GUI and all application logic
‚îú‚îÄ‚îÄ logic/
‚îÇ   ‚îî‚îÄ‚îÄ parser.py            # Helper module for parsing Excel files
‚îú‚îÄ‚îÄ configs/                 # Default directory for saving .json configuration files
‚îú‚îÄ‚îÄ requirements.txt         # List of required Python libraries
‚îú‚îÄ‚îÄ setup.py                 # Script to build the application into an .exe file
‚îú‚îÄ‚îÄ build.bat                # Convenience script for Windows to run the build
‚îú‚îÄ‚îÄ icon.ico                 # Application icon
‚îî‚îÄ‚îÄ README.md                # This documentation file
```

## üöÄ Installation and Execution

### System Requirements
- Windows 10 or later
- Python 3.9+
- Microsoft Office is not required

### Method 1: Run from Source Code

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd excel_mapper
    ```

2.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **Run the application:**
    ```bash
    python app.py
    ```

### Method 2: Build the Executable (.exe)

1.  **Automatic build (Windows):**
    Run the `build.bat` file.
    ```bash
    build.bat
    ```

2.  **Or, build manually:**
    ```bash
    python setup.py build
    ```

3.  **The executable will be created at:** `dist/ExcelDataMapper.exe`

## üìñ User Guide

### Step 1: Select Files
- **Source File**: Choose the Excel file containing the data you want to transfer.
- **Destination File**: Choose the Excel template file you want to populate. The formatting of this file will be preserved.

### Step 2: Configure Headers (Important!)
This step tells the application where the headers are located in each file.

- **Source Header Rows**: The row(s) containing the headers in the source file.
- **Destination Header Rows**: The row(s) containing the headers in the destination file.

Press **"Load Columns"** after configuring to have the application read and display the columns.

**ASCII Art Example:**

Assume your **Source** file has a simple header on the first row:
```
Source File (source.xlsx)
+---+--------------+----------+------------+
|   |      A       |    B     |     C      |
+---+--------------+----------+------------+
| 1 |  Employee ID  |  Amount  |    Date    |  <-- Header is on row 1
+---+--------------+----------+------------+
| 2 |    NV001     |   5000   | 2025-07-30 |
+---+--------------+----------+------------+
```
=> Configuration: `Source Header Rows: From [1] To [1]`

Assume your **Destination** file has a complex structure, with the header spanning from row 9 to 10:
```
Destination File (template.xlsx)
... (rows above are ignored)
+---+---------------------+----------------------+
|   |          C          |          D           |
+---+---------------------+----------------------+
| 8 |                     |                      |
+---+---------------------+----------------------+
| 9 |     INFORMATION     |       DETAILS        |  <-- Header starts on row 9
+---+---------------------+----------------------+
| 10|       Emp. ID       |        Amount        |  <-- Header ends on row 10
+---+---------------------+----------------------+
| 11| (data will go here) | (data will go here)  |
+---+---------------------+----------------------+
```
=> Configuration: `Destination Header Rows: From [9] To [10]`

### Step 3: Map Columns
- After clicking "Load Columns", the app will display columns from the source file on the left and from the destination file on the right.
- The system will automatically suggest mappings (e.g., "Amount" -> "Amount").
- You can change these suggestions using the dropdown menu for each source column.

### Step 4: Configure Sorting (Optional)
- In the "Sort Configuration" section, you can select a column from the **source** file to sort the data before it's written to the destination file.

### Step 5: Save/Load Configuration
- **Save Configuration**: Saves all current settings (file paths, headers, mappings) to a `.json` file.
- **Load Configuration**: Loads a previously saved configuration file to avoid re-configuring everything.

### Step 6: Execute
- Press **"Execute Transfer"** to start the data transfer process.
- A progress bar will show the status.
- On success, a notification will appear asking if you want to open the destination folder.

## ‚öôÔ∏è Advanced Configuration

### JSON Configuration File
You can view and edit the saved configuration file.
```json
{
  "source_file": "C:/path/to/source.xlsx",
  "dest_file": "C:/path/to/destination.xlsx",
  "source_header_start_row": 1,
  "source_header_end_row": 1,
  "dest_header_start_row": 9,
  "dest_header_end_row": 10,
  "sort_column": "Amount",
  "mapping": {
    "Employee ID": "Emp. ID",
    "Amount": "Amount",
    "Date": ""
  },
  "created_date": "2025-07-30T10:30:00"
}
```

## üîß Troubleshooting

### Common Errors

1.  **"Could not load columns"**
    -   **Primary Cause**: The header row configuration (Step 2) is incorrect. Double-check your Excel files.
    -   Verify the file paths.
    -   Ensure the file is not locked (open in Microsoft Excel). The application will try to warn you about this.

2.  **"Duplicate destination columns detected"**
    -   You have mapped multiple source columns to the same destination column. Each destination column can only receive data from a single source column.

3.  **"Transfer failed"**
    -   The destination file might be open or locked.
    -   Check write permissions in the destination folder.
    -   Review the `app.log` file for detailed technical reasons.

### Log File
All operations and errors are logged to the `app.log` file in the same directory as the application.
```
2025-07-30 11:00:15,123 - ERROR - File locked by processes: EXCEL.EXE
```

## ü§ù Contributing

### Reporting Bugs
1.  Open an "Issue" on the project's GitHub page.
2.  Attach the `app.log` file if possible.
3.  Describe the steps to reproduce the error in detail.

### Development
1.  Fork the repository.
2.  Create a new feature branch.
3.  Commit your changes with clear messages.
4.  Create a Pull Request.

## üìù License

APACHE 2.0 License.

---

**Developed by**: Do Huy Hoang
**Version**: 1.1.0
**Last Updated**: 2025-07-30

---
<br>

# (Ti·∫øng Vi·ªát) Excel Data Mapper

M·ªôt ·ª©ng d·ª•ng m·∫°nh m·∫Ω ƒë·ªÉ √°nh x·∫° v√† chuy·ªÉn d·ªØ li·ªáu gi·ªØa c√°c file Excel trong khi v·∫´n gi·ªØ nguy√™n ƒë·ªãnh d·∫°ng v√† style.

## ‚ú® T√≠nh nƒÉng ch√≠nh

- **√Ånh x·∫° c·ªôt linh ho·∫°t**: T·ª± ƒë·ªông g·ª£i √Ω v√† cho ph√©p √°nh x·∫° th·ªß c√¥ng gi·ªØa c·ªôt ngu·ªìn v√† ƒë√≠ch.
- **Gi·ªØ nguy√™n ƒë·ªãnh d·∫°ng**: B·∫£o to√†n ho√†n to√†n format, style, m√†u s·∫Øc, vi·ªÅn c·ªßa file Excel ƒë√≠ch.
- **X·ª≠ l√Ω merge cells**: H·ªó tr·ª£ ƒë·ªçc v√† ghi d·ªØ li·ªáu v√†o c√°c √¥ ƒë√£ ƒë∆∞·ª£c merge m·ªôt c√°ch th√¥ng minh.
- **S·∫Øp x·∫øp d·ªØ li·ªáu**: Cho ph√©p s·∫Øp x·∫øp d·ªØ li·ªáu theo c·ªôt ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh tr∆∞·ªõc khi chuy·ªÉn.
- **L∆∞u/T·∫£i c·∫•u h√¨nh**: L∆∞u c·∫•u h√¨nh √°nh x·∫° v√†o file JSON ƒë·ªÉ t√°i s·ª≠ d·ª•ng.
- **Giao di·ªán th√¢n thi·ªán**: S·ª≠ d·ª•ng ttkbootstrap v·ªõi 2 theme (s√°ng/t·ªëi) c√≥ th·ªÉ chuy·ªÉn ƒë·ªïi.
- **X·ª≠ l√Ω l·ªói to√†n di·ªán**: B√°o l·ªói r√µ r√†ng v√† c√≥ backup t·ª± ƒë·ªông cho file ƒë√≠ch.
- **Validation m·∫°nh m·∫Ω**: Ki·ªÉm tra t√≠nh h·ª£p l·ªá c·ªßa √°nh x·∫° (tr√°nh tr√πng l·∫∑p c·ªôt ƒë√≠ch) tr∆∞·ªõc khi th·ª±c hi·ªán.

### T√≠nh nƒÉng m·ªõi & C·∫£i ti·∫øn
- **Qu·∫£n l√Ω File Handle n√¢ng cao**: T√≠ch h·ª£p c∆° ch·∫ø t·ª± ƒë·ªông ph√°t hi·ªán v√† th√¥ng b√°o n·∫øu file Excel ƒëang b·ªã kh√≥a b·ªüi m·ªôt ch∆∞∆°ng tr√¨nh kh√°c (v√≠ d·ª•: Microsoft Excel), y√™u c·∫ßu ng∆∞·ªùi d√πng ƒë√≥ng l·∫°i ƒë·ªÉ tr√°nh l·ªói.
- **T·ª± ƒë·ªông gi·∫£i ph√≥ng b·ªô nh·ªõ**: Ch·ªß ƒë·ªông gi·∫£i ph√≥ng t√†i nguy√™n sau m·ªói thao t√°c ƒë·ªçc/ghi file ƒë·ªÉ tƒÉng t√≠nh ·ªïn ƒë·ªãnh v√† gi·∫£m thi·ªÉu r·ªßi ro treo ·ª©ng d·ª•ng.
- **C·∫£i thi·ªán logic ƒë·ªçc header**: ƒê·∫£m b·∫£o ƒë·ªçc ƒë∆∞·ª£c c√°c header ph·ª©c t·∫°p tr√™n nhi·ªÅu d√≤ng v√† lo·∫°i b·ªè c√°c c·ªôt kh√¥ng c√≥ t√™n.
- **C·∫£i thi·ªán logic ghi d·ªØ li·ªáu**: S·ª≠a l·ªói ghi ƒë√® l√™n header c·ªßa file ƒë√≠ch khi header c√≥ c√°c √¥ ƒë∆∞·ª£c merge theo chi·ªÅu d·ªçc.

## üèóÔ∏è C·∫•u tr√∫c d·ª± √°n (Th·ª±c t·∫ø)

C·∫•u tr√∫c d·ª± √°n ƒë√£ ƒë∆∞·ª£c tinh g·ªçn, v·ªõi ph·∫ßn l·ªõn logic ƒë∆∞·ª£c t·∫≠p trung trong `app.py` ƒë·ªÉ t·∫°o th√†nh m·ªôt ·ª©ng d·ª•ng ƒë·ªôc l·∫≠p, d·ªÖ ƒë√≥ng g√≥i.

```
excel_mapper/
‚îú‚îÄ‚îÄ app.py                   # File ch√≠nh ch·ª©a GUI v√† to√†n b·ªô logic ·ª©ng d·ª•ng
‚îú‚îÄ‚îÄ logic/
‚îÇ   ‚îî‚îÄ‚îÄ parser.py            # Module h·ªó tr·ª£ ph√¢n t√≠ch file Excel
‚îú‚îÄ‚îÄ configs/                 # Th∆∞ m·ª•c m·∫∑c ƒë·ªãnh l∆∞u c√°c file c·∫•u h√¨nh .json
‚îú‚îÄ‚îÄ requirements.txt         # Danh s√°ch c√°c th∆∞ vi·ªán Python c·∫ßn thi·∫øt
‚îú‚îÄ‚îÄ setup.py                 # Script ƒë·ªÉ build ·ª©ng d·ª•ng th√†nh file .exe
‚îú‚îÄ‚îÄ build.bat                # Script ti·ªán √≠ch cho Windows ƒë·ªÉ ch·∫°y build
‚îú‚îÄ‚îÄ icon.ico                 # Icon c·ªßa ·ª©ng d·ª•ng
‚îî‚îÄ‚îÄ README.md                # T√†i li·ªáu h∆∞·ªõng d·∫´n n√†y
```

## üöÄ C√†i ƒë·∫∑t v√† ch·∫°y

### Y√™u c·∫ßu h·ªá th·ªëng
- Windows 10 tr·ªü l√™n
- Python 3.9+
- Kh√¥ng c·∫ßn c√†i ƒë·∫∑t Microsoft Office

### C√°ch 1: Ch·∫°y t·ª´ source code

1. **Clone repository:**
```bash
git clone <repository-url>
cd excel_mapper
```

2. **C√†i ƒë·∫∑t dependencies:**
```bash
pip install -r requirements.txt
```

3. **Ch·∫°y ·ª©ng d·ª•ng:**
```bash
python app.py
```

### C√°ch 2: Build file th·ª±c thi (.exe)

1. **T·ª± ƒë·ªông build (Windows):**
Ch·∫°y file `build.bat`.
```bash
build.bat
```

2. **Ho·∫∑c build th·ªß c√¥ng:**
```bash
python setup.py build
```

3. **File th·ª±c thi s·∫Ω ƒë∆∞·ª£c t·∫°o t·∫°i:** `dist/ExcelDataMapper.exe`

## üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng

### B∆∞·ªõc 1: Ch·ªçn File
- **Source File**: Ch·ªçn file Excel ch·ª©a d·ªØ li·ªáu b·∫°n mu·ªën chuy·ªÉn ƒëi.
- **Destination File**: Ch·ªçn file Excel m·∫´u (template) m√† b·∫°n mu·ªën ƒëi·ªÅn d·ªØ li·ªáu v√†o. ƒê·ªãnh d·∫°ng c·ªßa file n√†y s·∫Ω ƒë∆∞·ª£c gi·ªØ nguy√™n.

### B∆∞·ªõc 2: C·∫•u h√¨nh Header (Quan tr·ªçng!)
ƒê√¢y l√† b∆∞·ªõc ƒë·ªÉ ch·ªâ cho ·ª©ng d·ª•ng bi·∫øt ƒë√¢u l√† d√≤ng ti√™u ƒë·ªÅ trong m·ªói file.

- **Source Header Rows**: C√°c d√≤ng ch·ª©a ti√™u ƒë·ªÅ trong file ngu·ªìn.
- **Destination Header Rows**: C√°c d√≤ng ch·ª©a ti√™u ƒë·ªÅ trong file ƒë√≠ch.

Nh·∫•n **"Load Columns"** sau khi c·∫•u h√¨nh xong ƒë·ªÉ ·ª©ng d·ª•ng ƒë·ªçc v√† hi·ªÉn th·ªã c√°c c·ªôt.

**V√≠ d·ª• minh h·ªça:**

Gi·∫£ s·ª≠ file **Source** c·ªßa b·∫°n c√≥ ti√™u ƒë·ªÅ ƒë∆°n gi·∫£n ·ªü d√≤ng ƒë·∫ßu ti√™n:

```
Source File (source.xlsx)
+---+--------------+----------+------------+
|   |      A       |    B     |     C      |
+---+--------------+----------+------------+
| 1 |  M√£ nh√¢n vi√™n |  S·ªë ti·ªÅn |  Ng√†y chi  |  <-- Header ·ªü d√≤ng 1
+---+--------------+----------+------------+
| 2 |    NV001     |   5000   | 2025-07-30 |
+---+--------------+----------+------------+
```
=> C·∫•u h√¨nh: `Source Header Rows: From [1] To [1]`

Gi·∫£ s·ª≠ file **Destination** c·ªßa b·∫°n c√≥ c·∫•u tr√∫c ph·ª©c t·∫°p, ti√™u ƒë·ªÅ n·∫±m t·ª´ d√≤ng 9 ƒë·∫øn d√≤ng 10:
```
Destination File (template.xlsx)
... (c√°c d√≤ng tr√™n b·ªã b·ªè qua)
+---+---------------------+----------------------+
|   |          C          |          D           |
+---+---------------------+----------------------+
| 8 |                     |                      |
+---+---------------------+----------------------+
| 9 |     TH√îNG TIN       |     CHI TI·∫æT         |  <-- Header b·∫Øt ƒë·∫ßu t·ª´ d√≤ng 9
+---+---------------------+----------------------+
| 10|      M√£ NV          |      Amount          |  <-- Header k·∫øt th√∫c ·ªü d√≤ng 10
+---+---------------------+----------------------+
| 11| (d·ªØ li·ªáu s·∫Ω v√†o ƒë√¢y) | (d·ªØ li·ªáu s·∫Ω v√†o ƒë√¢y) |
+---+---------------------+----------------------+
```
=> C·∫•u h√¨nh: `Destination Header Rows: From [9] To [10]`

### B∆∞·ªõc 3: √Ånh x·∫° c·ªôt
- Sau khi nh·∫•n "Load Columns", ·ª©ng d·ª•ng s·∫Ω hi·ªÉn th·ªã c√°c c·ªôt t·ª´ file ngu·ªìn b√™n tr√°i v√† c√°c c·ªôt t·ª´ file ƒë√≠ch b√™n ph·∫£i.
- H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông g·ª£i √Ω √°nh x·∫° (v√≠ d·ª•: "S·ªë ti·ªÅn" -> "Amount").
- B·∫°n c√≥ th·ªÉ thay ƒë·ªïi c√°c g·ª£i √Ω n√†y b·∫±ng c√°ch ch·ªçn t·ª´ danh s√°ch dropdown cho m·ªói c·ªôt ngu·ªìn.

### B∆∞·ªõc 4: C·∫•u h√¨nh s·∫Øp x·∫øp (T√πy ch·ªçn)
- Trong ph·∫ßn "Sort Configuration", b·∫°n c√≥ th·ªÉ ch·ªçn m·ªôt c·ªôt t·ª´ file **ngu·ªìn** ƒë·ªÉ s·∫Øp x·∫øp d·ªØ li·ªáu tr∆∞·ªõc khi ghi v√†o file ƒë√≠ch.

### B∆∞·ªõc 5: L∆∞u/T·∫£i c·∫•u h√¨nh
- **Save Configuration**: L∆∞u l·∫°i to√†n b·ªô c√†i ƒë·∫∑t hi·ªán t·∫°i (ƒë∆∞·ªùng d·∫´n file, header, √°nh x·∫°) ra m·ªôt file `.json`.
- **Load Configuration**: T·∫£i l·∫°i m·ªôt file c·∫•u h√¨nh ƒë√£ l∆∞u ƒë·ªÉ kh√¥ng ph·∫£i ch·ªçn l·∫°i t·ª´ ƒë·∫ßu.

### B∆∞·ªõc 6: Th·ª±c hi·ªán
- Nh·∫•n **"Execute Transfer"** ƒë·ªÉ b·∫Øt ƒë·∫ßu qu√° tr√¨nh chuy·ªÉn d·ªØ li·ªáu.
- Thanh ti·∫øn tr√¨nh s·∫Ω c·∫≠p nh·∫≠t tr·∫°ng th√°i.
- N·∫øu th√†nh c√¥ng, m·ªôt th√¥ng b√°o s·∫Ω hi·ªán ra v√† h·ªèi b·∫°n c√≥ mu·ªën m·ªü th∆∞ m·ª•c ch·ª©a file ƒë√≠ch kh√¥ng.

## ‚öôÔ∏è C·∫•u h√¨nh n√¢ng cao

### File c·∫•u h√¨nh JSON
B·∫°n c√≥ th·ªÉ xem v√† ch·ªânh s·ª≠a file c·∫•u h√¨nh ƒë√£ l∆∞u.
```json
{
  "source_file": "C:/path/to/source.xlsx",
  "dest_file": "C:/path/to/destination.xlsx",
  "source_header_start_row": 1,
  "source_header_end_row": 1,
  "dest_header_start_row": 9,
  "dest_header_end_row": 10,
  "sort_column": "S·ªë ti·ªÅn",
  "mapping": {
    "M√£ nh√¢n vi√™n": "M√£ NV",
    "S·ªë ti·ªÅn": "Amount",
    "Ng√†y chi": ""
  },
  "created_date": "2025-07-30T10:30:00"
}
```

## üîß X·ª≠ l√Ω s·ª± c·ªë

### L·ªói th∆∞·ªùng g·∫∑p

1.  **"Could not load columns"**
    -   **Nguy√™n nh√¢n ch√≠nh**: C·∫•u h√¨nh d√≤ng header (B∆∞·ªõc 2) kh√¥ng ch√≠nh x√°c. H√£y ki·ªÉm tra l·∫°i file Excel c·ªßa b·∫°n.
    -   Ki·ªÉm tra l·∫°i ƒë∆∞·ªùng d·∫´n file.
    -   ƒê·∫£m b·∫£o file kh√¥ng b·ªã kh√≥a (ƒëang m·ªü trong Microsoft Excel). ·ª®ng d·ª•ng s·∫Ω c·ªë g·∫Øng c·∫£nh b√°o b·∫°n v·ªÅ ƒëi·ªÅu n√†y.

2.  **"Duplicate destination columns detected"**
    -   B·∫°n ƒë√£ √°nh x·∫° nhi·ªÅu c·ªôt ngu·ªìn v√†o c√πng m·ªôt c·ªôt ƒë√≠ch. M·ªói c·ªôt ƒë√≠ch ch·ªâ ƒë∆∞·ª£c nh·∫≠n d·ªØ li·ªáu t·ª´ m·ªôt c·ªôt ngu·ªìn duy nh·∫•t.

3.  **"Transfer failed"**
    -   File ƒë√≠ch c√≥ th·ªÉ ƒëang m·ªü ho·∫∑c b·ªã kh√≥a.
    -   Ki·ªÉm tra quy·ªÅn ghi file trong th∆∞ m·ª•c ƒë√≠ch.
    -   Xem log chi ti·∫øt trong `app.log` ƒë·ªÉ bi·∫øt nguy√™n nh√¢n k·ªπ thu·∫≠t.

### Log file
T·∫•t c·∫£ c√°c ho·∫°t ƒë·ªông v√† l·ªói ƒë·ªÅu ƒë∆∞·ª£c ghi v√†o file `app.log` trong c√πng th∆∞ m·ª•c v·ªõi ·ª©ng d·ª•ng.
```
2025-07-30 11:00:15,123 - ERROR - File locked by processes: EXCEL.EXE
```

## ü§ù ƒê√≥ng g√≥p

### B√°o l·ªói
1. M·ªü m·ªôt "Issue" tr√™n trang GitHub c·ªßa d·ª± √°n.
2. ƒê√≠nh k√®m file `app.log` n·∫øu c√≥ th·ªÉ.
3. M√¥ t·∫£ chi ti·∫øt c√°c b∆∞·ªõc ƒë·ªÉ t√°i hi·ªán l·ªói.

### Ph√°t tri·ªÉn
1. Fork repository.
2. T·∫°o m·ªôt feature branch m·ªõi.
3. Commit c√°c thay ƒë·ªïi v·ªõi message r√µ r√†ng.
4. T·∫°o m·ªôt Pull Request.

## üìù License

APACHE 2.0 License.

---

**Ph√°t tri·ªÉn b·ªüi**: Do Huy Hoang
**Phi√™n b·∫£n**: 1.1.0
**Ng√†y c·∫≠p nh·∫≠t**: 2025-07-30